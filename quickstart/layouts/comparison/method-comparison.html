{{ define "main" }}
<div class="container mt-5">
    <div class="row mb-4">
        <div class="col-md-8 mx-auto text-center">
            <h1 class="display-4 fw-bold text-serif" style="color: #5D4037;">{{ .Title }}</h1>
            <p class="lead text-brown">{{ .Description }}</p>
            <hr class="my-4 w-25 mx-auto" style="border-color: #8D6E63;">
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-8">
            <!-- Method comparison chart -->
            <div class="card shadow-sm border-0 mb-4" style="background-color: #EFEBE9; border-color: #D7CCC8;">
                <div class="card-body p-4">
                    <h3 class="h5 mb-3" style="color: #795548;">Comparative Analysis: Methods Effectiveness</h3>
                    <div class="chart-container" style="position: relative; height:450px;">
                        <canvas id="radarChart"></canvas>
                    </div>
                </div>
                <div class="card-footer" style="background-color: #F5F5F5; border-top-color: #D7CCC8;">
                    <small class="text-muted">Radar chart comparison of five peer review methodologies across six key dimensions</small>
                </div>
            </div>
            
            <!-- Ranking table -->
            <div class="card shadow-sm border-0 mb-4" style="background-color: #EFEBE9; border-color: #D7CCC8;">
                <div class="card-header" style="background-color: #F5F5DC; border-bottom-color: #D7CCC8;">
                    <h3 class="h5 mb-0" style="color: #795548;">Method Rankings by Dimension</h3>
                </div>
                <div class="card-body p-4">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead style="border-bottom-color: #D7CCC8;">
                                <tr>
                                    <th scope="col" style="border-bottom-color: #D7CCC8; color: #5D4037;">Dimension</th>
                                    <th scope="col" style="border-bottom-color: #D7CCC8; color: #5D4037;">Top Method</th>
                                    <th scope="col" style="border-bottom-color: #D7CCC8; color: #5D4037;">Runner-up</th>
                                    <th scope="col" style="border-bottom-color: #D7CCC8; color: #5D4037;">Score Range</th>
                                    <th scope="col" style="border-bottom-color: #D7CCC8; color: #5D4037;">Significance</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="color: #5D4037;"><strong>Feedback Quality</strong></td>
                                    <td>Rubric-Based</td>
                                    <td>AI-Assisted</td>
                                    <td>8.7 - 5.2</td>
                                    <td><span class="badge" style="background-color: #F5F5DC; color: #795548;">High</span></td>
                                </tr>
                                <tr>
                                    <td style="color: #5D4037;"><strong>Time Efficiency</strong></td>
                                    <td>AI-Assisted</td>
                                    <td>Minimal</td>
                                    <td>9.2 - 5.6</td>
                                    <td><span class="badge" style="background-color: #F5F5DC; color: #795548;">High</span></td>
                                </tr>
                                <tr>
                                    <td style="color: #5D4037;"><strong>Reviewer Consistency</strong></td>
                                    <td>Rubric-Based</td>
                                    <td>AI-Assisted</td>
                                    <td>8.9 - 5.8</td>
                                    <td><span class="badge" style="background-color: #F5F5DC; color: #795548;">High</span></td>
                                </tr>
                                <tr>
                                    <td style="color: #5D4037;"><strong>Student Satisfaction</strong></td>
                                    <td>Double-Blind</td>
                                    <td>Rubric-Based</td>
                                    <td>8.2 - 6.4</td>
                                    <td><span class="badge" style="background-color: #F5F5DC; color: #795548;">Medium</span></td>
                                </tr>
                                <tr>
                                    <td style="color: #5D4037;"><strong>Implementation Cost</strong></td>
                                    <td>Minimal</td>
                                    <td>Open-Ended</td>
                                    <td>9.1 - 6.2</td>
                                    <td><span class="badge" style="background-color: #F5F5DC; color: #795548;">Medium</span></td>
                                </tr>
                                <tr>
                                    <td style="color: #5D4037;"><strong>Learning Outcomes</strong></td>
                                    <td>Rubric-Based</td>
                                    <td>Double-Blind</td>
                                    <td>8.5 - 6.7</td>
                                    <td><span class="badge" style="background-color: #F5F5DC; color: #795548;">Medium</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Heat map comparison -->
            <div class="card shadow-sm border-0 mb-4" style="background-color: #EFEBE9; border-color: #D7CCC8;">
                <div class="card-header" style="background-color: #F5F5DC; border-bottom-color: #D7CCC8;">
                    <h3 class="h5 mb-0" style="color: #795548;">Method Compatibility Matrix</h3>
                </div>
                <div class="card-body p-4">
                    <div class="chart-container" style="position: relative; height:400px;">
                        <canvas id="heatmapChart"></canvas>
                    </div>
                    <div class="mt-3 small text-muted">
                        <p class="mb-0">Color intensity represents the synergy level when methods are combined. Darker colors indicate higher compatibility.</p>
                    </div>
                </div>
            </div>
            
            <!-- Context factors -->
            <div class="card shadow-sm border-0 mb-4" style="background-color: #EFEBE9; border-color: #D7CCC8;">
                <div class="card-header" style="background-color: #F5F5DC; border-bottom-color: #D7CCC8;">
                    <h3 class="h5 mb-0" style="color: #795548;">Contextual Performance</h3>
                </div>
                <div class="card-body p-4">
                    <div class="chart-container" style="position: relative; height:400px;">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
                <div class="card-footer" style="background-color: #F5F5F5; border-top-color: #D7CCC8;">
                    <small class="text-muted">Overall effectiveness score of each method across different educational contexts</small>
                </div>
            </div>
            
            <!-- Content from markdown -->
            <div class="content-card p-4 shadow-sm rounded mt-4" style="background-color: #FFF8E1; border: 1px solid #EEEEEE;">
                {{ .Content }}
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="sticky-top">
                <!-- Methods overview -->
                <div class="sidebar-card p-4 shadow-sm rounded mb-4" style="background-color: #F5F5DC; border: 1px solid #E8E6D9;">
                    <h4 class="border-bottom pb-2 mb-3" style="color: #795548; border-color: #D7CCC8;"><i class="fas fa-clipboard-list me-2"></i>Methods Compared</h4>
                    <div class="accordion" id="methodsAccordion">
                        <div class="accordion-item border-0 bg-transparent">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                    <span class="text-primary">Open-Ended</span>
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#methodsAccordion">
                                <div class="accordion-body pt-0">
                                    Traditional free-form peer review with minimal guidance. Reviewers provide general feedback based on their understanding of quality.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item border-0 bg-transparent">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    <span class="text-primary">Rubric-Based</span>
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#methodsAccordion">
                                <div class="accordion-body pt-0">
                                    Structured review using detailed rubrics with specific criteria and scoring guidelines to guide reviewer feedback.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item border-0 bg-transparent">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    <span class="text-primary">Double-Blind</span>
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#methodsAccordion">
                                <div class="accordion-body pt-0">
                                    Anonymous review where neither the author nor the reviewer knows the other's identity, reducing bias in assessment.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item border-0 bg-transparent">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                    <span class="text-primary">AI-Assisted</span>
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#methodsAccordion">
                                <div class="accordion-body pt-0">
                                    Technology-enhanced peer review using AI to suggest feedback points and identify areas needing attention.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item border-0 bg-transparent">
                            <h2 class="accordion-header" id="headingFive">
                                <button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
                                    <span class="text-primary">Minimal</span>
                                </button>
                            </h2>
                            <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#methodsAccordion">
                                <div class="accordion-body pt-0">
                                    Streamlined approach with quick checkbox evaluations and minimal written feedback, optimized for efficiency.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Research notes -->
                <div class="card border-0 shadow-sm mb-4" style="background-color: #EFEBE9;">
                    <div class="card-header" style="background-color: #F5F5DC; border-bottom-color: #D7CCC8;">
                        <h5 class="mb-0" style="color: #795548;">Research Approach</h5>
                    </div>
                    <div class="card-body">
                        <p class="small mb-3">This comparative analysis was conducted across multiple institutions with consistent testing parameters:</p>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex align-items-center px-0 bg-transparent small">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <span>5 distinct peer review methods</span>
                            </li>
                            <li class="list-group-item d-flex align-items-center px-0 bg-transparent small">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <span>1,200+ students participating</span>
                            </li>
                            <li class="list-group-item d-flex align-items-center px-0 bg-transparent small">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <span>3 distinct educational contexts</span>
                            </li>
                            <li class="list-group-item d-flex align-items-center px-0 bg-transparent small">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <span>6 performance dimensions measured</span>
                            </li>
                            <li class="list-group-item d-flex align-items-center px-0 bg-transparent small">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                <span>Statistical significance testing applied</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- Download option -->
                <div class="card border-0 shadow-sm text-center" style="background-color: #EFEBE9;">
                    <div class="card-body">
                        <h5 class="mb-3" style="color: #795548;">Download Data</h5>
                        <button class="btn btn-outline-primary me-2" style="background-color: #F5F5DC; color: #795548; border-color: #D7CCC8;" id="downloadReport">
                            <i class="fas fa-file-pdf me-1"></i> Full Report
                        </button>
                        <button class="btn btn-outline-success" style="background-color: #F5F5DC; color: #8D6E63; border-color: #D7CCC8;" id="downloadData">
                            <i class="fas fa-table me-1"></i> Comparison Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mt-5">
        {{ partial "comments.html" . }}
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Charts initialization script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Common data
    const methodLabels = ['Open-Ended', 'Rubric-Based', 'Double-Blind', 'AI-Assisted', 'Minimal'];
    const dimensions = ['Feedback Quality', 'Time Efficiency', 'Reviewer Consistency', 'Student Satisfaction', 'Implementation Cost', 'Learning Outcomes'];
    const colors = {
        openEnded: {
            base: 'rgba(121, 85, 72, 0.7)',
            border: 'rgb(121, 85, 72)',
            light: 'rgba(121, 85, 72, 0.2)'
        },
        rubricBased: {
            base: 'rgba(161, 136, 127, 0.7)',
            border: 'rgb(161, 136, 127)',
            light: 'rgba(161, 136, 127, 0.2)'
        },
        doubleBlind: {
            base: 'rgba(141, 110, 99, 0.7)',
            border: 'rgb(141, 110, 99)',
            light: 'rgba(141, 110, 99, 0.2)'
        },
        aiAssisted: {
            base: 'rgba(93, 64, 55, 0.7)',
            border: 'rgb(93, 64, 55)',
            light: 'rgba(93, 64, 55, 0.2)'
        },
        minimal: {
            base: 'rgba(188, 170, 164, 0.7)',
            border: 'rgb(188, 170, 164)',
            light: 'rgba(188, 170, 164, 0.2)'
        }
    };
    
    // Radar Chart for dimension comparison
    const radarCtx = document.getElementById('radarChart').getContext('2d');
    const radarData = {
        labels: dimensions,
        datasets: [
            {
                label: 'Open-Ended',
                data: [6.2, 6.5, 5.8, 6.8, 8.2, 7.4],
                backgroundColor: colors.openEnded.light,
                borderColor: colors.openEnded.border,
                borderWidth: 2,
                pointBackgroundColor: colors.openEnded.border,
                pointRadius: 4
            },
            {
                label: 'Rubric-Based',
                data: [8.7, 6.8, 8.9, 7.6, 7.3, 8.5],
                backgroundColor: colors.rubricBased.light,
                borderColor: colors.rubricBased.border,
                borderWidth: 2,
                pointBackgroundColor: colors.rubricBased.border,
                pointRadius: 4
            },
            {
                label: 'Double-Blind',
                data: [7.2, 6.2, 7.9, 8.2, 6.5, 8.3],
                backgroundColor: colors.doubleBlind.light,
                borderColor: colors.doubleBlind.border,
                borderWidth: 2,
                pointBackgroundColor: colors.doubleBlind.border,
                pointRadius: 4
            },
            {
                label: 'AI-Assisted',
                data: [8.4, 9.2, 7.5, 7.9, 6.2, 7.8],
                backgroundColor: colors.aiAssisted.light,
                borderColor: colors.aiAssisted.border,
                borderWidth: 2,
                pointBackgroundColor: colors.aiAssisted.border,
                pointRadius: 4
            },
            {
                label: 'Minimal',
                data: [5.2, 7.8, 6.4, 6.4, 9.1, 6.7],
                backgroundColor: colors.minimal.light,
                borderColor: colors.minimal.border,
                borderWidth: 2,
                pointBackgroundColor: colors.minimal.border,
                pointRadius: 4
            }
        ]
    };
    
    new Chart(radarCtx, {
        type: 'radar',
        data: radarData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    angleLines: {
                        display: true
                    },
                    beginAtZero: true,
                    suggestedMin: 0,
                    suggestedMax: 10,
                    ticks: {
                        stepSize: 2
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': ' + context.raw + '/10';
                        }
                    }
                },
                legend: {
                    position: 'top'
                }
            }
        }
    });
    
    // Heat Map Chart for method compatibility
    const heatCtx = document.getElementById('heatmapChart').getContext('2d');
    const heatmapData = {
        datasets: [{
            data: [
                { x: 'Open-Ended', y: 'Open-Ended', v: 1.0 },
                { x: 'Open-Ended', y: 'Rubric-Based', v: 0.6 },
                { x: 'Open-Ended', y: 'Double-Blind', v: 0.7 },
                { x: 'Open-Ended', y: 'AI-Assisted', v: 0.5 },
                { x: 'Open-Ended', y: 'Minimal', v: 0.3 },
                
                { x: 'Rubric-Based', y: 'Open-Ended', v: 0.6 },
                { x: 'Rubric-Based', y: 'Rubric-Based', v: 1.0 },
                { x: 'Rubric-Based', y: 'Double-Blind', v: 0.8 },
                { x: 'Rubric-Based', y: 'AI-Assisted', v: 0.9 },
                { x: 'Rubric-Based', y: 'Minimal', v: 0.5 },
                
                { x: 'Double-Blind', y: 'Open-Ended', v: 0.7 },
                { x: 'Double-Blind', y: 'Rubric-Based', v: 0.8 },
                { x: 'Double-Blind', y: 'Double-Blind', v: 1.0 },
                { x: 'Double-Blind', y: 'AI-Assisted', v: 0.7 },
                { x: 'Double-Blind', y: 'Minimal', v: 0.4 },
                
                { x: 'AI-Assisted', y: 'Open-Ended', v: 0.5 },
                { x: 'AI-Assisted', y: 'Rubric-Based', v: 0.9 },
                { x: 'AI-Assisted', y: 'Double-Blind', v: 0.7 },
                { x: 'AI-Assisted', y: 'AI-Assisted', v: 1.0 },
                { x: 'AI-Assisted', y: 'Minimal', v: 0.6 },
                
                { x: 'Minimal', y: 'Open-Ended', v: 0.3 },
                { x: 'Minimal', y: 'Rubric-Based', v: 0.5 },
                { x: 'Minimal', y: 'Double-Blind', v: 0.4 },
                { x: 'Minimal', y: 'AI-Assisted', v: 0.6 },
                { x: 'Minimal', y: 'Minimal', v: 1.0 }
            ],
            backgroundColor: ({ raw }) => {
                const value = raw.v || 0;
                return `rgba(121, 85, 72, ${value})`;
            },
            borderWidth: 1,
            borderColor: 'rgba(215, 204, 200, 0.5)',
            width: ({ chart }) => (chart.chartArea || {}).width / 5 - 1,
            height: ({ chart }) => (chart.chartArea || {}).height / 5 - 1
        }]
    };

    // Custom heatmap implementation using bar chart
    new Chart(heatCtx, {
        type: 'matrix',
        data: heatmapData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        title: () => null,
                        label: (context) => {
                            const data = context.raw;
                            return [
                                `${data.x} + ${data.y}`,
                                `Compatibility: ${Math.round(data.v * 100)}%`
                            ];
                        }
                    }
                }
            },
            scales: {
                x: {
                    type: 'category',
                    labels: methodLabels,
                    offset: true,
                    ticks: {
                        display: true
                    },
                    grid: {
                        display: false
                    }
                },
                y: {
                    type: 'category',
                    labels: methodLabels,
                    offset: true,
                    ticks: {
                        display: true
                    },
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
    
    // Bar Chart for context comparison
    const barCtx = document.getElementById('barChart').getContext('2d');
    const barData = {
        labels: methodLabels,
        datasets: [
            {
                label: 'Undergraduate Courses',
                data: [7.4, 8.9, 7.6, 8.2, 7.8],
                backgroundColor: 'rgba(121, 85, 72, 0.7)',
                borderColor: 'rgb(121, 85, 72)',
                borderWidth: 1
            },
            {
                label: 'Graduate Seminars',
                data: [6.8, 8.7, 8.5, 8.7, 6.2],
                backgroundColor: 'rgba(161, 136, 127, 0.7)',
                borderColor: 'rgb(161, 136, 127)',
                borderWidth: 1
            },
            {
                label: 'Professional Development',
                data: [5.9, 8.2, 8.1, 9.1, 7.4],
                backgroundColor: 'rgba(141, 110, 99, 0.7)',
                borderColor: 'rgb(141, 110, 99)',
                borderWidth: 1
            }
        ]
    };
    
    new Chart(barCtx, {
        type: 'bar',
        data: barData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    mode: 'index',
                    intersect: false
                },
                legend: {
                    position: 'top',
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 10,
                    title: {
                        display: true,
                        text: 'Effectiveness Score (0-10)'
                    }
                }
            }
        }
    });
    
    // Download buttons (placeholders)
    document.getElementById('downloadReport').addEventListener('click', function() {
        alert('Full report download functionality would be implemented here');
    });
    
    document.getElementById('downloadData').addEventListener('click', function() {
        alert('Comparison data download functionality would be implemented here');
    });
});
</script>
{{ end }} 